<!doctype html>
<html lang=ru id=faq>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD FAQ: Управление клавиатурой и дисплеем</title>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/faq7.html">

<h2 id=OpenBSD>
<a href="../index.html">
<i>Open</i><b>BSD</b></a>
FAQ - Управление клавиатурой и дисплеем
<small>
<a href="index.html">[FAQ - На главную]</a>
</small>
</h2>
<hr>

<ul>
<li><a href="#Consoles"       >Работа в консоли</a>
  <ul>
  <li><a href="#Keyboard"     >Переназначить клавиши на клавиатуре</a>
  <li><a href="#ConsoleMouse" >Поддержка мыши в консоли</a>
  <li><a href="#SwitchConsole">Переключение между консолями</a>
  </ul>
<li><a href="#VGAConsoles"    >Консоли на VGA Hardware</a>
  <ul>
  <li><a href="#Scrollback"   >Буфер прокрутки</a>
  <li><a href="#AddConsole"   >Добавление виртуальных консолей</a>
  <li><a href="#Size80x50"    >Изменение шрифтов и разрешения консоли</a>
  </ul>
<li><a href="#Blanker"        >Отчистка неактивной консоли</a>
<li><a href="#SerCon"         >Последовательный порт для доступа к консоли</a>
</ul>
<hr>

<h2 id="Consoles">Работа в консоли</h2>

<h3 id="Keyboard">Переназначить клавиши на клавиатуре</h3>

Утилита <a href="https://man.openbsd.org/kbd">kbd(8)</a> может быть
использована для изменений кодировки клавиатуры.
Большинством настроек клавиатуры можно управлять при помоши утилиты
<a href="https://man.openbsd.org/wsconsctl">wsconsctl(8)</a>.
К примеру, чтобы переназначить клавиши (to change keymappings) при помощи
<a href="https://man.openbsd.org/wsconsctl">wsconsctl(8)</a>,
сделайте следующее:

<pre class="cmdbox">
# <b>wsconsctl keyboard.encoding=uk</b>
</pre>

Переназначить <code>[Caps Lock]</code> на
<code>[Control L]</code>, левую клавишу control:

<pre class="cmdbox">
# <b>wsconsctl keyboard.map+="keysym Caps_Lock = Control_L"</b>
</pre>

Чтобы настройки сохранились, используйте файл
<a href="https://man.openbsd.org/wsconsctl.conf">wsconsctl.conf(5)</a>.

<h3 id="ConsoleMouse">Поддержка мыши в консоли</h3>

Для платформ <a href="../alpha.html">alpha</a>,
<a href="../amd64.html">amd64</a> и <a href="../i386.html">i386</a>
OpenBSD предоставляет
<a href="https://man.openbsd.org/wsmoused">wsmoused(8)</a>.
Его можно включить при помощи утилиты <a href="https://man.openbsd.org/rcctl">rcctl(8)</a>,
<a href="faq10.html#rc">описанной в FAQ</a>.


<h3 id="SwitchConsole">Переключение между консолями</h3>

Для большинства alpha, amd64 и i386 систем OpenBSD по умолчанию
предоставляет шесть виртуальных терминалов: от <code>/dev/ttyC0</code>
до <code>/dev/ttyC5</code>.
Вы можете переключаться между ними, используя <code>[CTRL]+[ALT]</code>
вместе с <code>[F1]</code> до <code>[F6]</code>.
Виртуальный терминал <code>ttyC4</code> зарезервирован для использования
<a href="faq11.html">X Window system</a>.

<h2 id="VGAConsoles">Консоли на VGA Hardware</h2>

<b>Внимание:</b> в этом разделе речь идет о возможностях драйвера
<a href="https://man.openbsd.org/vga">vga(4)</a>. Они поддерживаются
не всеми видеокартами. Приведенные ниже инструкции
<b>не будут работать на современном железе</b>, которое использует
драйвер <a href="https://man.openbsd.org/drm">drm(4)</a>.

<h3 id="Scrollback">Буфер прокрутки</h3>

На некоторых платформах OpenBSD предоставляет буфер прокрутки экрана
консоли (console scrollback buffer). Он позволяет вам вернуться к
информации, которую уже не видно на экране из-за появления новой.
Для перемещения вверх и вниз используйте комбинации клавиш
<code>[SHIFT]+[PGUP]</code> и <code>[SHIFT]+[PGDN]</code>.
Количество экранов, помещающихся в буфера прокрутки - 8. 
Переключение консолей очистит буфер прокрутки.
Из-за ограничений на используемое место,  ядро, используемое
для установки системы, не поддерживает возможности прокрутки.

<h3 id="AddConsole">Добавление виртуальных консолей</h3>

Если вы хотите, чтобы виртуальных консолей было больше, используйте команду
<a href="https://man.openbsd.org/wsconscfg">wsconscfg(8)</a> для создания
новых экранов для <code>ttyC6</code>, <code>ttyC7</code> и т.д. Например:

<pre class="cmdbox">
# <b>wsconscfg -t 80x25 6</b>       # this will not work on systems using drm(4)
</pre>

Это создаст виртуальный терминал для <code>ttyC6</code>, доступ к которому
будет осуществляться при помощи <code>[CTRL]+[ALT]+[F7]</code>.
Чтобы получить приглашение <code>login:</code> на только что созданной
виртуальной консоли, вам нужно включить его как <code>on</code> в
<a href="https://man.openbsd.org/ttys">ttys(5)</a>,
и либо перезагрузить <a href="https://man.openbsd.org/init">init(8)</a>,
либо отправить ему сигнал HUP при помощи
<a href="https://man.openbsd.org/kill">kill(1)</a>.
Добавьте эту команду в <a href="https://man.openbsd.org/rc.local">rc.local(8)</a>,
если вам потребуется дополнительная консоль при следующей загрузке компьютера.

<h3 id="Size80x50">Изменение шрифтов и разрешения консоли</h3>

Многие VGA видеокарты на alpha, amd64 и i386 способны отображать 50 строк
текста в высоком разрешении вместо обычных 25.
Стандартный 80x25 экран использует шрифт 8x16 пикселей.
Чтобы удвоить количество строк, мы сначала загружаем шрифт 8x8 пикселей при
помощи <a href="https://man.openbsd.org/wsfontload">wsfontload(8)</a>.
Затем мы удаляем и создаем заново виртуальную консоль с нужным разрешением
экрана, используя  <a href="https://man.openbsd.org/wsconscfg">wsconscfg(8)</a>.
Это можно сделать автоматически при загрузке, добавив следующие команды в
конец <a href="https://man.openbsd.org/rc.local">rc.local(8)</a> скрипта:

<pre class="cmdbox">
wsfontload -h 8 -e ibm /usr/share/misc/pcvtfonts/vt220l.808	# load 8x8 font
wsconscfg -dF 5			# delete screen 5 accessed by [CTRL]+[ALT]+[F6]
wsconscfg -t 80x50 5		# add screen 5 with 50 lines of 80 characters
</pre>

Если вы хотите изменить другие screens, просто повторите шаги удаления и
добавления экрана для других экранов. Невозможно изменить разрешение основного
консольного устройства <code>ttyC0</code>, доступ к которому осуществляется при
помощью <code>[CTRL]+[ALT]+[F1]</code>. Избегайте изменения экрана 4, который
используется X в качестве графического экрана.

<h2 id="Blanker">Отчистка неактивной консоли</h2>

Если вы хотите, чтобы экран отключался после определенного периода неактивности
консоли (без использования X), можете установить следующие параметры
<a href="https://man.openbsd.org/wscons">wscons(4)</a>:

<ul>
  <li><b><code>display.screen_off</code></b>
    определяет время в тысячных долях секунды, после которых экран будет погашен.
  <li><b><code>display.kbdact</code></b>
    установка этого параметра как <code>on</code>, делает возможным пробудить
    экран при любой активности с клавиатуры.
  <li><b><code>display.msact</code></b>
    установка этого параметра как <code>on</code>, приведет к тому, что экран
    будет пробуждаться при любой активности <a href="#ConsoleMouse" >конольной мыши</a>.
  <li><b><code>display.outact</code></b>
    установка этого парамерта как <code>on</code> обозначает, что экран будет
    просыпаться, если на экран будет выведенно что-то новое.
  <li><b><code>display.vblank</code></b>
    установка этого параметра как <code>on</code> отключает вертикальное обновление
    экрана.
    Это приведет к тому, что многие мониторы перейдут в режим энергосбережения.
</ul>

Вы можете установить эти переменные в командной строке, используя для этого
<a href="https://man.openbsd.org/wsconsctl">wsconsctl(8)</a>:

<pre class="cmdbox">
# <b>wsconsctl display.screen_off=60000</b>
display.screen_off -> 60000
</pre>

или установить их перманентно (изменения вступят в силу после перезагрузки),
отредактировав
<a href="https://man.openbsd.org/wsconsctl.conf">wsconsctl.conf(5)</a>.
Отключение экрана активируется лишь в том случае, если одна из двух переменных
<code>display.kbdact</code> или <code>display.outact</code> установленна как
<code>on</code>. Еще одно замечание - одна из них должна быть <code>off</code>.

<h2 id="SerCon">Последовательный порт для доступа к консоли</h2>

OpenBSD поддерживает работу консоли через последовательный порт на большенстве
платформ, однако существуют различия в ее работе на разных платфомах.
Помимо того, что пользователи могут таким образом входить в систему,
они также могут быть использованы для записи вывода с консоли.

<p>
Использование полноценной последовательной консоли в OpenBSD состоит
из двух частей:

<ul>
  <li>Позволяет использовать последовательный порт в качестве интерактивного
      терминала, чтобы пользователь мог войти в него при работе в
      многопользовательском режиме.
  <li>Можно настроить OpenBSD для использования последовательного порта в
      качестве консоли лишь для мониторинга состояния системы и
      однопользовательского режима. Эта часть сильно зависит от платформы.
</ul>

<h3 id="SerContty">Настройка возможности входа в систему через <code>/etc/ttys</code></h3>

Terminal sessions are controlled by the
<a href="https://man.openbsd.org/ttys">ttys(5)</a> file.
Before OpenBSD will give you a <code>login:</code> prompt at a device,
it has to be enabled in <code>/etc/ttys</code>.
The serial terminal is disabled by default on platforms which typically have
a keyboard and screen attached.
We'll use the amd64 platform as an example.
In this case, you must edit the line that reads:

<pre class="cmdbox">
tty00   "/usr/libexec/getty std.9600"   unknown off
</pre>

to read something like:

<pre class="cmdbox">
tty00   "/usr/libexec/getty std.9600"   vt220   on secure
</pre>

Here, <code>tty00</code> is the serial port we are using as a console and
<code>vt220</code> is the
<a href="https://man.openbsd.org/termcap.5">termcap(5)</a>
entry that matches your terminal.
Other likely options might include <code>vt100</code>, <code>xterm</code>, etc.
The <code>on</code> bit enables the login prompt by activating
<a href="https://man.openbsd.org/getty">getty(8)</a> for that serial port.
The <code>secure</code> bit permits a <code>root</code> login at this console.
The <code>9600</code> bit is the terminal baud rate.

<p>
Note that you can use a serial console for install without doing this step, as
the system is running in single user mode, and not using <code>getty</code> for
login.

<p>
On some platforms and some configurations, you must bring the system up in
single user mode to make this change if a serial console is all you have
available.

<h3>amd64 and i386</h3>

To configure the boot process to use the serial port as a console, your
<a href="https://man.openbsd.org/amd64/boot.conf">boot.conf(5)</a> file should
include the line:

<pre class="cmdbox">
set tty com0
</pre>

This file is put on your boot drive, which could also be your install media.
Use the <code>stty</code> option if you need a baud rate other than 9600bps.

<p>
Some systems may be able to operate without a video card in the machine,
but certainly not all -- many consider this an error condition.
Others are capable of redirecting all BIOS keyboard and screen activity to
a serial port through a configuration option, so the machine can be
completely maintained through the serial port.
Your results may vary.
When using this feature, some BIOS implementations may prevent the boot loader
from seeing the serial port, thus the kernel will not be told to use it.
There may be a BIOS option "Continue Console Redirection after POST."
This should be set to OFF, so the boot loader and the kernel can handle
their own console.

<p>
To use the machine in multi-user mode, you will need to edit
<code>/etc/ttys</code> as <a href="#SerContty">explained above</a>.

<h3>sparc64</h3>

These machines are designed to be completely maintainable with a serial console.
Simply remove the keyboard from the machine, and the system will run serial.

<p>
On some systems, the serial ports are labeled <code>ttya</code>,
<code>ttyb</code>, <code>ttyh0</code> or <code>ttyh1</code>.
It is not necessary to make any changes to <code>/etc/ttys</code> to use a
serial console in multi-user mode.

<p>
Some sparc64 systems interpret a BREAK signal on the console port to be the
same as a STOP-A command.
This kicks the system back to the Forth prompt, stopping any application
and operating system at that point.
This is handy when desired, but unfortunately, some serial terminals at
power-down and some RS-232 switching devices send something the computer
interprets as a break signal, halting the machine.
Test before you go into production.

<p>
If you have a keyboard and monitor attached, you can still force the
serial console to be used instead by using the following commands at the
<code>ok</code> prompt:

<pre class="cmdbox">
ok <b>setenv input-device ttya</b>
ok <b>setenv output-device ttya</b>
ok <b>reset</b>
</pre>

If <code>ttyC0</code> is active in <code>/etc/ttys</code>, as
<a href="#SerContty">explained above</a>, you can use the keyboard and
monitor in X.

<h3>macppc</h3>

The macppc machines are configured for a serial console through OpenFirmware.
Use the commands:

<pre class="cmdbox">
ok <b>setenv output-device scca</b>
ok <b>setenv input-device scca</b>
ok <b>reset-all</b>
</pre>

Set your serial console to 57600bps, 8N1.

<p>
Unfortunately, serial console is not directly possible on most MacPPCs.
While most of these machines do have serial hardware, it isn't accessible
outside the machine.
Fortunately, a few companies offer add-on devices for several Macintosh
models which will make this port available for use as a serial console.

<p>
You will have to change <code>tty00</code> in <code>/etc/ttys</code> to
<code>on</code> and set the speed to 57600 instead of the default of 9600 as
detailed <a href="#SerContty">above</a> in single user mode before booting
multi-user and having the serial console functional.

<h3>I get input/output error when trying to use my tty devices</h3>

You need to use <code>/dev/cuaXX</code> for connections initiated from the
OpenBSD system.
The <code>/dev/ttyXX</code> devices are intended only for terminal or dial-in
usage.
Refer to the <a href="https://man.openbsd.org/cua">cua(4)</a> manual for more
details.
